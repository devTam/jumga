### Can you build a payment system that helps businesses grow?

This project contains the requirements for the MVP for Jumga, a payment system that helps businesses grow. [Jumga](https://jumga.vercel.app) is an Ecommerce platform where users can search through mutiple stores for groceries to apparel and even electronics

There are currently three stores available on the platform which you can start to shop from right away

-   _[Eden's Jewelery](https://jumga.vercel.app/merchants/edens-jewelery)_: A jewelery shop
-   _[Dessy's Thrift](https://jumga.vercel.app/merchants/dessys-thrift)_: A unisex clothing shop
-   _[Atom Electronics](https://jumga.vercel.app/merchants/atom-electronics)_: An electronics shop

## Tasks

Two tasks were given in this project, creating merchant accounts and making transactions with the flutterwave API

### Creating Merchant Accounts

![Creating Merchant Accounts](/public/creating-merchant-shops.jpg)

The system listens for changes in the [authentication state](https://github.com/ebinabo/jumga/blob/main/lib/auth.js) of the client and checks if the user and checks if the current user, if any has a merchant account and gets the information on it [here](https://github.com/ebinabo/jumga/blob/main/lib/merchants.js). The logic is also responsible for redirecting a user to [`/dashboard/profile/create`](https://github.com/ebinabo/jumga/blob/main/pages/dashboard/profile/create.js) if the user hasn't created an account yet. Both of these are available to use across the entire [app](https://github.com/ebinabo/jumga/blob/main/pages/_app.js) via hooks.

On all [`dashboard/profile/**`](https://github.com/ebinabo/jumga/tree/main/pages/dashboard/profile) routes, If no user is signed in, the app shows the [auth](https://github.com/ebinabo/jumga/blob/main/components/Authentication.js) component. After the user is signed in, they are redirected to [`dashboard/profile`](https://github.com/ebinabo/jumga/blob/main/pages/dashboard/profile/index.js).

On the profile page, a user is shown an alert if the subscription of the user is not yet complete. Clicking on this would call an [`api/subscribe`](https://github.com/ebinabo/jumga/blob/main/pages/api/subscribe.ts) that returns a url link to carry on with checkouts. Pay with card was made inactive in the sandbox environment for USD transactions so NGN 10,000 was used instead. After checkout is complete, the merchant slug is passed to [`api/confirm/subscription/[slug]`](https://github.com/ebinabo/jumga/blob/main/pages/api/confirm/subscription/%5Bslug%5D.ts) which confirms the payment was made and updates the user's status on the database.

The merchant is also able to add financial information to the platform and this creates a subaccount for the user. The subaccount field is a dropdown in this case because there's a finite number of accounts that work in a test environment. The data for available accounts is pulled from the database as well. On submit, [`api/subaccount`](https://github.com/ebinabo/jumga/blob/main/pages/api/subaccount.ts) is called and this creates a subaccount for the merchant and assigns a dispatch rider to the merchant and updates the data in the database.

The merchant is now able to receive payments after inventorry is added to their store.

### Making a Transaction

![Making  a Transaction](/public/making-a-transaction.jpg)

The example given in the task did not specify percentages for transactions so a framework that gives Jumga 15% of every transaction capped at 2,000 NGN was used and these numbers can be changed per requirement.

Transactions are initialized by clicking the [checkout](https://github.com/ebinabo/jumga/blob/main/pages/merchants/%5Bslug%5D/cart.js) button on `/merchants/[slug]/cart` where `[slug]` is a unique merchant slug. This calls [`/api/initialize`](https://github.com/ebinabo/jumga/blob/main/pages/api/initialize.ts). The items in the cart as well as the information on the current store such as their subaccount and dispatch riders subaccount are sent along with the request.

The result of the request is sent back to the cart and causes a redirect to the link generated by Flutterwave when a transaction is initialized.

The redirect_url body param sent along with the Fluterwave request points to [`/api/confirm/order/[...params]`](https://github.com/ebinabo/jumga/blob/main/pages/api/confirm/order/%5B...params%5D.ts). It takes in the merchant slug, amount and currency of the transaction. These are used to verify the transaction and update the database accordingly. These are passed in as a query parameter, params. This approach was used because The entire query sent with the Flutterwave redirect, status, tx_ref and transaction_id replace whatever queries coming after `?`

[`/api/confirm/order/[...params]`](https://github.com/ebinabo/jumga/blob/main/pages/api/confirm/order/%5B...params%5D.ts) makes a call to Flutterwave to verify the transaction was successful and ensure that it is valid before the order is then updated in the database and value can be provided. On completion, the user is redirected to `merchants/[slug]/confirm-order`

[`merchants/[slug]/confirm-order`](https://github.com/ebinabo/jumga/blob/main/pages/merchants/%5Bslug%5D/confirm-order.js) shows that the transaction was or gives an option to retry in the event that the transaction wasn't successful as shown in the diagram above.

## Getting Started Locally

First, run the development server:

```bash
npm run dev
# or
yarn dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

## Deployment

This project is built in React. [Next.js](https://nextjs.org/) is used because of the awesome developer experience and features it provides out of the box.

[Firebase](https://firebase.google.com/) is used for the database and authentication of the application.

[Tailwindcss](https://tailwindcss.com/) is used for the styling.

[Prismic](https://prismic.io/) is used as a CMS for the landing pages.

This application is deployed on [Vercel](https://vercel.com) as it is the easiest way to deploy a Next application while harnessing all the features

## Concerns

No test accounts provided for USD transactions so naira was used for subscription
